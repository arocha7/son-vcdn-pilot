---

- name: previous install APTitude
  apt: name=aptitude state=latest

- name: upgrade all packages to the latest version
  apt: upgrade=yes update_cache=yes

- name: install required libraries and tools for PIP
  apt: name={{ item }} state=latest
  with_items:
  - build-essential
  - python-setuptools
  - python-dev
  - python-pip
  - openssl
  - libssl-dev
  - libffi-dev

- name: install Openstack command line clients
  apt: name={{ item }} state=latest
  with_items:
  - nova-common
  - python-openstackclient
  - python-keystoneclient
  - python-heatclient
  - python-glanceclient
  - python-cinderclient
  - python-swiftclient
  #- python-magnumclient
  - python-novaclient
  - python-neutronclient
  #- python-troveclient
  - python-designateclient
  #- python-ironicclient

- name: get PIP
  get_url:
    url="https://bootstrap.pypa.io/get-pip.py"
    dest="/tmp"

- name: deploy PIP
  command: python /tmp/get-pip.py

- name: "Install dependency libraries"
  pip: name={{ item }}  state=present
  with_items:
  - PyYAML
  - setuptools
  - pycrypto>=2.6
  - requests
  - six
  - requestsexceptions>=1.1.1
  - python-systemd
  - pbr
  - os-client-config>=1.22.0
  - netifaces>=0.10.4
  - munch
  - keystoneauth1>=2.11.0
  - jsonpatch
  - ipaddress
  - dogpile.cache>=0.5.3
  - decorator

- name: install SHADE
  pip: name=shade state=present


# Install 'shade' python module (needed by Ansible Cloud module)
#- name: get Shade tarball
#  get_url:
#    url="https://pypi.python.org/packages/7e/1f/2409fd66f2574a2dc9daf335b47384e91f1ae52d8c1bb713ec1f840e188d/shade-{{ shade_tarball }}.tar.gz#md5=a09e159e35727bbb68eb3e5779658df4"
#    dest="/tmp"
#  register: new_archive

#- name: install tarball
#  pip: name=file:///tmp/shade-{{ shade_tarball }}.tar.gz
#  when: new_archive|changed

